
<div class="container">
<!--Botones de ingreso y reingreso de productos-->
<div class="row">
  <div class="col">
    <h1>Inventario</h1>
  </div>
  <div class="col">
    <div class="btn-group float-left">
      <button type="button" class="btn btn-success" data-toggle="modal" data-target="#modalIngreso">
        <fa-icon [icon]="faPlusCircle"></fa-icon> Ingreso
      </button>
      <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#modalReingreso">
        <fa-icon [icon]="faPlusCircle"></fa-icon> Reingreso
      </button>
      <button type="button" class="btn btn-warning" data-toggle="modal" data-target="#modalEgreso">
        <fa-icon [icon]="faSignOutAlt"></fa-icon> Egreso
      </button>
    </div>
    <div class="btn-group float-right">
      <button type="button" class="btn btn-info" data-toggle="modal" data-target="#modalModificar">
        <fa-icon [icon]="faPencilAlt"></fa-icon> Modificar
      </button>
      <button type="button" class="btn btn-danger" data-toggle="modal" data-target="#modalReporte">
        <fa-icon [icon]="faExclamationCircle"></fa-icon> Reportar
      </button>
    </div>
  </div>
</div>

<div class="row">
  <!--Tabla de inventario en donde se muestra el inventario general-->
    <table class="table shadow">
      <thead class="thead-dark">
        <tr>
          <!--Filtro por nombre de Inventario, busca el item que haga match-->
          <th scope="col">
            <input #filtroNombre="ngModel" class="w-75 form-control form-control-sm" ngModel type="text" placeholder="Filtro por nombre">
          </th>

          <th scope="col">
            <select #filtroCategoria="ngModel" class="form-control form-control-sm" ngModel name="filtroCategoria">
              <option value="">Categoría (Todas)</option>
              <option *ngFor="let cat of categorias" [value]="cat.nombre">{{ cat.nombre }}</option>
            </select>
          </th>
          <th scope="col"></th>
          <th scope="col">
            <select #filtroUbicacion="ngModel" class="form-control form-control-sm" ngModel name="filtroUbicacion">
              <option value="">Ubicación (Todas)</option>
              <option *ngFor="let ubicacion of ubicaciones" [value]="ubicacion.nombre">{{ ubicacion.nombre }}</option>
            </select>
          </th>
          <th scope="col"></th>
          <th scope="col"></th>
        </tr>
      </thead>
      <thead class="thead-dark">
        <tr>
          <th scope="col">Nombre</th>
          <th scope="col">Categoría</th>
          <th scope="col">Cantidad</th>
          <th scope="col">Ubicación</th>
          <th scope="col">Estado</th>
          <th></th>
        </tr>
      </thead>

      <tbody>
      <!-- *ngIf="(item.nombre.toLocaleLowerCase().includes(filtroNombre.value.toLowerCase() || item.tipo == filtroCategoria.value)) || filtroNombre.value == ''" -->

      <!--NgFor que imprime inventario de base de datos (itemsInventario), este a su vez compara con el Filtro por nombre en minusculas-->
        <ng-container *ngFor="let item of inventario">
          <tr
            scope="row"
            *ngIf="(
              (item.nombre.toLocaleLowerCase().includes(filtroNombre.value.toLowerCase()) || filtroNombre.value == '')
              &&
              (item.tipo == filtroCategoria.value || filtroCategoria.value == '')
              &&
              (item.ubicacion == filtroUbicacion.value || filtroUbicacion.value == '')
            )"
            class="bg-light">
            <td>{{ item.nombre }}</td>
            <td>{{ item.tipo }}</td>
            <td><span [ngClass]="{'text-danger': item.estado=='En Obra'}">{{ item.cantidad }} {{ item.unidades }}</span></td>
            <td>{{ item.ubicacion }}</td>
            <td [ngClass]="{'text-success': item.estado=='Disponible',
                            'text-danger': item.estado=='Dañado',
                            'text-info': item.estado=='En Obra'}">{{ item.estado }}</td>
            <td>
              <div class="btn-group">
                <button (click)="asignarDetalles(item)" type="button" class="btn btn-info btn-sm" data-toggle="modal" data-target="#modalInfo">
                <fa-icon [icon]="faInfoCircle"></fa-icon> Detalles
              </button>
              <button (click)="asignarBorrar(item.id, item.nombre)" type="button" class="btn btn-danger btn-sm" data-toggle="modal" data-target="#modalEliminar">
                <fa-icon [icon]="faInfoCircle"></fa-icon> Eliminar
              </button>
              </div>
            </td>
          </tr>
        </ng-container>
      </tbody>
  </table>
</div>
<!-- INICIO MODAL ELIMINAR -->
<div class="modal" tabindex="-1" id="modalEliminar">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header bg-danger">
        <h5 class="modal-title text-white">Eliminar Item</h5>
      </div>
      <div class="modal-body">
        <p>¿Estás seguro que deseas eliminar <strong>{{ itemBorrar.nombre }}</strong>?. <br> <span class="text-danger">Esta acción es irreversible.</span></p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancelar</button>
        <button (click)="eliminarItem()" data-dismiss="modal" type="button" class="btn btn-danger">Eliminar</button>
      </div>
    </div>
  </div>
</div>
<!-- FIN MODAL ELIMINAR -->
<!-- MODAL DE INFO -->
<div class="modal fade" id="modalInfo" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header bg-info">
        <h5 class="modal-title text-white" id="exampleModalLabel"><strong>{{ datosInfo.nombre }}</strong></h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <table class="table table-sm">
          <tbody>
              <tr>
                <th>ID</th>
                  <td></td>
                  <td>{{ datosInfo.id }}</td>
              </tr>
              <tr *ngIf="datosInfo.serial != null">
                <th>Serial</th>
                  <td></td>
                  <td>{{ datosInfo.serial }}</td>
              </tr>
              <tr>
                <th>Categoría</th>
                  <td></td>
                  <td>{{ datosInfo.tipo }}</td>
              </tr>
              <tr>
                <th>Cantidad</th>
                  <td></td>
                  <td>{{ datosInfo.cantidad }} {{datosInfo.unidades }}</td>
              </tr>
              <tr *ngIf="datosInfo.ubicacion != null">
                <th>Ubicación</th>
                  <td></td>
                  <td>{{ datosInfo.ubicacion }}</td>
              </tr>
              <tr *ngIf="datosInfo.responsable != null && datosInfo.fecha != null">
                <th>Primer ingreso por</th>
                  <td></td>
                  <td>{{ datosInfo.responsable }} ({{ datosInfo.fecha }})</td>
              </tr>
              <tr *ngIf="datosInfo.estado != null">
                <th>Estado</th>
                  <td></td>
                  <td>{{ datosInfo.estado }}</td>
              </tr>
              <tr *ngIf="datosInfo.vencimiento != null">
                <th>Vencimiento</th>
                  <td></td>
                  <td>{{ datosInfo.vencimiento }}</td>
              </tr>
              <tr *ngIf="datosInfo.precio != null">
                <th>Precio</th>
                  <td></td>
                  <td>{{ datosInfo.precio |currency}}</td>
              </tr>
              <tr><th></th><td></td><td></td></tr>
          </tbody>
      </table>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Cerrar</button>
      </div>
    </div>
  </div>
</div>
<!-- FIN DEL MODAL INFO -->
  </div>

<!--MODAL DE REPORTE DE PRODUCTO-->
<div class="modal fade" id="modalReporte" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog">
  <div class="modal-content">

      <div class="modal-header bg-danger text-white">
        <h5 class="modal-title" id="exampleModalLabel">Reporte</h5>
        <button type="button" class="close text-white" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>

      <!--Filtro por Tipo de reingreso-->
      <div class="modal-body">
      <form #f="ngForm">
          <h3>Item</h3>
          <div class="form-group">
            <div class="row">
              <div class="col">
                  <label>Categoría</label>
                    <select class="form-control" ngModel name="selectTipoReporte" #selectTipoReporte="ngModel">
                      <option *ngFor="let categoria of categorias" value="{{categoria.nombre}}">{{ categoria.nombre }}</option>
                    </select>
              </div>
              <div class="col">
                  <label>Item</label>
                  <select #idItem="ngModel" (change)="alElegirItem(idItem.value)" class='form-control' ngModel name="id">
                    <!--NG FOR QUE COLOCA LA LISTA DE INVENTARIO-->
                    <ng-container *ngFor="let item of inventario">
                      <!--NG IF QUE FILTRA LA LISTA FINAL POR EL TIPO-->
                      <ng-container *ngIf="item.tipo == selectTipoReporte.value && item.estado != 'En Obra'">
                        <option value='{{item.id}}'>{{ item.nombre }}</option>
                      </ng-container>
                    </ng-container>
                  </select>
              </div>
            </div>
          </div>

        <!--Footer de Modal de reingreso, con botones de cerrar e ingresar-->
        <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-dismiss="modal" (click)="borrarForm()">
              <fa-icon [icon]="faTimesCircle"></fa-icon> Cerrar
            </button>

            <button data-dismiss="modal" *ngIf="idItem.value && regresarItem(idItem.value).estado == 'Dañado'" type="button" class="btn btn-primary"  (click)="reportarReparado()">
              <fa-icon [icon]="faExclamationCircle"></fa-icon> Reportar Reparado
            </button>
            <button *ngIf="idItem.value && regresarItem(idItem.value).estado == 'Disponible'" data-dismiss="modal" type="button" class="btn btn-danger" (click)="reportarAveria()">
              <fa-icon [icon]="faExclamationCircle"></fa-icon> Reportar Dañado
            </button>

        </div>

      </form>
    </div>
  </div>
  </div>
</div>





<!-- Modal Ingreso-->
<div class="modal fade" id="modalIngreso" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <app-ingreso></app-ingreso>
</div>
<!-- Modal Reingreso-->
<div class="modal fade" id="modalReingreso" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <app-reingreso></app-reingreso>
</div>
<!-- Modal Egreso-->
<div class="modal fade" id="modalEgreso" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <app-egreso></app-egreso>
</div><!-- Modal Modificar-->
<div class="modal fade" id="modalModificar" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <app-modificar></app-modificar>
</div>
